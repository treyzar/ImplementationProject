# Конструктор документов (Document Builder)

## Обзор проекта

Визуальный конструктор документов с возможностью создания шаблонов, добавления различных блоков (текст, таблицы, изображения, подписи), парсинга DOCX и PDF файлов. Интерфейс выполнен в оранжевой палитре в стиле компании Бреслер.

### Технологии

- **Backend**: Django 5.x + Django REST Framework
- **Frontend**: React 18 + TypeScript + Vite + shadcn/ui + Tailwind CSS
- **База данных**: SQLite (development)
- **Парсинг**: python-docx, pdfplumber

## Структура проекта

```
/
├── backend/                    # Django backend
│   ├── config/                 # Настройки Django
│   │   ├── settings.py
│   │   └── urls.py
│   ├── document_builder/       # Приложение конструктора
│   │   ├── models.py           # DocumentTemplate, SourceFile
│   │   ├── serializers.py      # DRF сериализаторы
│   │   ├── views.py            # ViewSets и API views
│   │   ├── urls.py             # API маршруты
│   │   └── utils.py            # Парсеры DOCX/PDF
│   └── manage.py
├── frontend/                   # React frontend
│   ├── src/
│   │   ├── api/                # API клиент
│   │   ├── components/         # React компоненты
│   │   │   ├── ui/             # shadcn/ui компоненты
│   │   │   └── document-builder/
│   │   │       ├── DocumentCanvas.tsx
│   │   │       ├── InspectorPanel.tsx
│   │   │       ├── SidebarBlocks.tsx
│   │   │       ├── SidebarFiles.tsx
│   │   │       ├── Toolbar.tsx
│   │   │       └── types.ts
│   │   ├── lib/                # Утилиты (cn function)
│   │   └── pages/              # Страницы
│   │       └── DocumentBuilderPage.tsx
│   └── vite.config.ts
└── replit.md                   # Этот файл
```

## Запуск проекта

### Development

Проект запускается через workflow "Document Builder":
- Backend: `http://localhost:8000`
- Frontend: `http://localhost:5000`

### API Endpoints

| Метод | URL | Описание |
|-------|-----|----------|
| GET/POST | `/api/documents/templates/` | Список/создание шаблонов |
| GET/PATCH/DELETE | `/api/documents/templates/{id}/` | CRUD шаблона |
| GET | `/api/documents/source-files/` | Список файлов |
| GET/DELETE | `/api/documents/source-files/{id}/` | Файл и парсинг |
| POST | `/api/documents/upload-source-file/` | Загрузка файла |

## Функционал

### Визуальный редактор
- Холст формата A4
- Drag-and-drop блоков
- Изменение размера блоков
- Управление масштабом (50-200%)
- Undo/Redo операций
- Множественный выбор блоков (Shift+клик)

### Выравнивание блоков (как в Figma)
- Выровнять по левому краю
- Выровнять по центру
- Выровнять по правому краю
- Выровнять по верхнему краю
- Выровнять по середине
- Выровнять по нижнему краю
- Распределить по горизонтали
- Распределить по вертикали

### Типы блоков
- Текстовые блоки
- Таблицы
- Изображения
- Поля подписи
- Прямоугольники (фигуры)

### Работа с файлами
- Загрузка DOCX и PDF
- Автоматический парсинг текста
- Просмотр содержимого по страницам

## Цветовая палитра (Бреслер)

```css
--color-primary: #E73F0C       /* Основной оранжевый */
--color-primary-dark: #C2360A  /* Тёмный оранжевый */
--color-primary-light: #FFE1D4 /* Светлый оранжевый */
--color-text-dark: #26292A     /* Тёмный текст */
--color-text-secondary: #4A4D50 /* Вторичный текст */
--color-background: #F7F8F8    /* Светлый фон */
--color-surface: #FFFFFF       /* Поверхности */
```

## Последние изменения

- 2025-12-05: Обновлён модуль конструктора документов
  - Добавлен множественный выбор блоков (Shift+клик)
  - Реализовано выравнивание блоков (как в Figma)
  - Интеграция shadcn/ui компонентов
  - Применена оранжевая палитра Бреслер
  - Обновлён InspectorPanel с современным дизайном

---

# Инструкция по интеграции для разработчиков

## Frontend

### 1. Структура компонентов

| Файл | Описание |
|------|----------|
| `DocumentBuilderPage.tsx` | Главная страница редактора, управление состоянием |
| `Toolbar.tsx` | Верхняя панель инструментов |
| `DocumentCanvas.tsx` | Холст с блоками |
| `SidebarBlocks.tsx` | Левая панель с типами блоков |
| `SidebarFiles.tsx` | Панель загруженных файлов |
| `InspectorPanel.tsx` | Правая панель свойств блока |
| `types.ts` | TypeScript типы и утилиты выравнивания |

### 2. Используемые shadcn/ui компоненты

```bash
# Убедитесь, что все компоненты установлены:
npx shadcn@latest add button card scroll-area tabs dialog dropdown-menu popover tooltip input textarea label select slider separator toggle toggle-group switch
```

### 3. Ключевые функции выравнивания

```typescript
// types.ts
alignBlocks(blocks, selectedIds, mode)  // mode: 'left' | 'center' | 'right' | 'top' | 'middle' | 'bottom'
distributeBlocks(blocks, selectedIds, direction)  // direction: 'horizontal' | 'vertical'
```

### 4. Множественный выбор

- `selectedBlockIds: string[]` — массив ID выбранных блоков
- `Shift+клик` — добавление/удаление блока из выбора
- Обычный клик — выбор одного блока

## Backend

### Изменения не требуются

Backend использует стандартный REST API без WebSocket. Все данные передаются через HTTP-запросы.

### Проверка работоспособности

```bash
# Проверить API
curl http://localhost:8000/api/documents/templates/

# Проверить миграции
cd backend && python manage.py showmigrations
```

---

# Простой пользовательский гид

## Как открыть конструктор

1. Откройте страницу проекта в браузере
2. Вы увидите редактор документов с белым холстом в центре

## Как создать новый документ

1. Нажмите кнопку **Новый** в левом верхнем углу (иконка с плюсом)
2. Введите название документа в поле ввода рядом с кнопкой
3. Холст очистится для нового документа

## Как добавить блок

1. Посмотрите на **левую панель** с надписью "Блоки"
2. Нажмите на нужный тип блока:
   - **Текст** — для добавления текста
   - **Таблица** — для добавления таблицы
   - **Изображение** — для добавления картинки
   - **Подпись** — для поля подписи
   - **Прямоугольник** — для геометрической фигуры
3. Блок появится на холсте

## Как переместить блок

1. Наведите мышку на блок
2. Зажмите левую кнопку мыши
3. Перетащите блок в нужное место
4. Отпустите кнопку мыши

## Как изменить размер блока

1. Нажмите на блок, чтобы выбрать его
2. В правом нижнем углу блока появится **оранжевый квадратик**
3. Потяните за него, чтобы изменить размер

## Как выбрать несколько блоков

1. Нажмите на первый блок
2. Зажмите клавишу **Shift** на клавиатуре
3. Нажимайте на другие блоки, удерживая Shift
4. Внизу экрана появится подсказка, сколько блоков выбрано

## Как выровнять блоки

1. Выберите **2 или более блока** (с помощью Shift+клик)
2. На верхней панели найдите кнопки выравнивания (иконки с полосками)
3. Нажмите нужную кнопку:
   - Три полоски слева — выровнять по левому краю
   - Три полоски по центру — выровнять по центру
   - Три полоски справа — выровнять по правому краю
   - Вертикальные кнопки — выравнивание по вертикали

## Как распределить блоки равномерно

1. Выберите **3 или более блока**
2. Найдите кнопки с точками между полосками
3. Нажмите для равномерного распределения

## Как сохранить документ

1. Введите название в поле вверху
2. Нажмите **оранжевую кнопку "Сохранить"**
3. Появится сообщение об успешном сохранении

## Как загрузить файл

1. Нажмите кнопку **"Загрузить файл"** на верхней панели
2. Выберите файл PDF или DOCX на компьютере
3. Файл появится в **правой нижней панели** "Файлы"
4. Нажмите на файл, чтобы посмотреть его содержимое

## Как отменить действие

- Нажмите кнопку **со стрелкой влево** — отменить
- Нажмите кнопку **со стрелкой вправо** — повторить

## Как изменить масштаб

1. В правом верхнем углу найдите **минус** и **плюс**
2. Нажимайте для уменьшения или увеличения холста
3. Между кнопками показан текущий масштаб (например, 100%)

## Как удалить блок

1. Выберите блок нажатием на него
2. На **правой панели** "Свойства" найдите **красную иконку корзины**
3. Нажмите на неё для удаления блока

---

## Пользовательские предпочтения

- Язык интерфейса: русский
- Стек: Django REST Framework + React + TypeScript + shadcn/ui
- Стиль: Оранжевая палитра Бреслер
